---
title: "Transcript analyisis Genes"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyr)
library("stringr")        
```

# Introduction
From COSMIC, the file from "COSMIC Mutation Data" (https://cancer.sanger.ac.uk/cosmic/download) was filtered for cancer "haematopoietic_and_lymphoid_tissue" and downloaded. 

The aim of this analysis is to see whether the mane transcripts retain more of the variants in cosmic than the altervatives transcripts of a gene. There are a number of ways to track a COSMIC variants, either genomic position, Genomic mutation identifier (COSV) or Legacy mutation identifier (COSM).
For this analysis, the Genomic mutation identifier (COSV) will filtered for anything not null then the Legacy mutation identifier (COSM) will be filtered for coding ID (there are COSN which is non coding). Thencosmic variants with no protein mutation description are removed as some COSM are outside exons but labelled COSM as they are thought to impact other transcript functions such as splicing, promoter regions etc.

COSMIC is based off ENSEMBL transcripts and not all ensembl transcripts can be easily mapped to RefSeq transcripts which is what we use. So this analysis will only be looking at the ENSEMBL but their respective RefSeq transcripts will be noted to make this analysis more clear for us. The Refseq and ENSEMBL transcripts were mapped using CCDS (e.g https://www.ncbi.nlm.nih.gov/projects/CCDS/CcdsBrowse.cgi?REQUEST=ALLFIELDS&DATA=CXCR4&ORGANISM=0&BUILDS=CURRENTBUILDS).

```{r }
setwd("~/Documents/Projects/myeloid/capture_design/annotation_sources/")

# This table is filtered for the cancer "haematopoietic_and_lymphoid_tissue'
dat <- read.table("cosmic/V95_38_MUTANT.csv", header = T, stringsAsFactors = F, sep = ",")
dat <- dat %>% 
            separate(GENE_NAME,  c("Gene", "Transcript"), "_")
```

```{r }
new_genes <- c("IRF4", "CARD11", "UBA1", "ANKRD26", "BCL2", "ARID1A", "MEF2B", "BTK", "DIS3", "CXCR4", "RHOA")

old_genes_not_MANE <- c("BCORL1", "CUX1", "FBXW7", "GNAS", "KRAS" )

old_genes_MANE <- c('ASXL1',	'ATM',	'BCOR',	'BIRC3',	'BRAF',	'CALR',	'CBL',	'CEBPA',	'CREBBP',	'CSF3R',	'DDX41',	'DNMT3A',	'EP300',	'ETNK1',	'ETV6',	'EZH2',	'FLT3',	'GATA1',	'GATA2',	'GNB1',	'HRAS',	'IDH1',	'IDH2',	'IKZF1',	'JAK1',	'JAK2',	'KIT',	'KMT2A',	'KMT2C',	'MPL',	'MYD88',	'NF1',	'NFE2',	'NOTCH1',	'NPM1',	'NRAS',	'PAX5',	'PHF6',	'PPM1D',	'PTEN',	'PTPN11',	'RAD21',	'RUNX1',	'SETBP1',	'SF3B1',	'SH2B3',	'SRSF2',	'STAG2',	'STAT3',	'STAT5B',	'TET2',	'TP53',	'U2AF1',	'WT1',	'ZRSR2')

old_genes_missing_one_mane <- c('BRAF', 'HRAS')
summary_tbl <- c()
```


## New genes
```{r}


for (gene in new_genes){
  print(gene)
  df <- dat[which(dat$Gene == gene),]
  # grep COSMIC legacy mutation IDs that are coding by selecting those that start with COSM
  # COSN is non coding
  df <- df[str_detect(df$LEGACY_MUTATION_ID, "COSM"), ]
  print(paste("The Ensemble transcripts for", gene, " is:", paste(unique(df$ACCESSION_NUMBER), collapse =  " & "), collapse = ""))

  txs = paste(unique(df$ACCESSION_NUMBER))
  # sometimes there are null COSVs which have COSM values but these dont have clear AA annotation
  # so these can be removed
  total_COSMs <- unique(df[which(df$GENOMIC_MUTATION_ID != "null" &  df$MUTATION_DESCRIPTION != "Unknown"), "LEGACY_MUTATION_ID"])
  print(paste("Total COSMs for this gene is: ", length(total_COSMs), sep = " "))
  for (i in 1:length(txs)){
    transcripts = txs[i]
    
    print(paste(transcripts, length(unique(df[which(df$ACCESSION_NUMBER %in% transcripts & df$GENOMIC_MUTATION_ID != "null" &  df$MUTATION_DESCRIPTION != "Unknown"), "LEGACY_MUTATION_ID"]))), sep = "_")
    
    row <- c(gene, transcripts, length(unique(df[which(df$ACCESSION_NUMBER %in% transcripts & df$GENOMIC_MUTATION_ID != "null" &  df$MUTATION_DESCRIPTION != "Unknown"), "LEGACY_MUTATION_ID"])))
    summary_tbl <- rbind(summary_tbl, row)
  }
  
  print("-----------------------------")
}


```

## BRAF & HRAS

```{r}
for (gene in old_genes_missing_one_mane){
  print(gene)
  df <- dat[which(dat$Gene == gene),]
  # grep COSMIC legacy mutation IDs that are coding by selecting those that start with COSM
  # COSN is non coding
  df <- df[str_detect(df$LEGACY_MUTATION_ID, "COSM"), ]
  print(paste("The Ensemble transcripts for", gene, " is:", paste(unique(df$ACCESSION_NUMBER), collapse =  " & "), collapse = ""))

  txs = paste(unique(df$ACCESSION_NUMBER))
  # sometimes there are null COSVs which have COSM values but these dont have clear AA annotation
  # so these can be removed
  total_COSMs <- unique(df[which(df$GENOMIC_MUTATION_ID != "null" & df$MUTATION_DESCRIPTION != "Unknown"), "LEGACY_MUTATION_ID"])
  print(paste("Total COSMs for this gene is: ", length(total_COSMs), sep = " "))
  for (i in 1:length(txs)){
    transcripts = txs[i]
    
    print(paste(transcripts, length(unique(df[which(df$ACCESSION_NUMBER %in% transcripts & df$GENOMIC_MUTATION_ID != "null" & df$MUTATION_DESCRIPTION != "Unknown"), "LEGACY_MUTATION_ID"]))), sep = "_")
    
    row <- c(gene, transcripts, length(unique(df[which(df$ACCESSION_NUMBER %in% transcripts & df$GENOMIC_MUTATION_ID != "null" & df$MUTATION_DESCRIPTION != "Unknown"), "LEGACY_MUTATION_ID"])))
    summary_tbl <- rbind(summary_tbl, row)
  }
  print("-----------------------------")
}


```





## Old genes not MANE

```{r}
for (gene in old_genes_not_MANE){
  print(gene)
  df <- dat[which(dat$Gene == gene),]
  # grep COSMIC legacy mutation IDs that are coding by selecting those that start with COSM
  # COSN is non coding
  df <- df[str_detect(df$LEGACY_MUTATION_ID, "COSM"), ]
  print(paste("The Ensemble transcripts for", gene, " is:", paste(unique(df$ACCESSION_NUMBER), collapse =  " & "), collapse = ""))

  txs = paste(unique(df$ACCESSION_NUMBER))
  total_COSMs <- unique(df[which(df$GENOMIC_MUTATION_ID != "null" &  df$MUTATION_DESCRIPTION != "Unknown"), "LEGACY_MUTATION_ID"])
  print(paste("Total COSMs for this gene is: ", length(total_COSMs), sep = " "))
  for (i in 1:length(txs)){
    transcripts = txs[i]
    
    print(paste(transcripts, length(unique(df[which(df$ACCESSION_NUMBER %in% transcripts & df$GENOMIC_MUTATION_ID != "null" &  df$MUTATION_DESCRIPTION != "Unknown"), "LEGACY_MUTATION_ID"]))), sep = "_")
    
    row <- c(gene, transcripts, length(unique(df[which(df$ACCESSION_NUMBER %in% transcripts & df$GENOMIC_MUTATION_ID != "null" &  df$MUTATION_DESCRIPTION != "Unknown"), "LEGACY_MUTATION_ID"])))
    summary_tbl <- rbind(summary_tbl, row)
  }
  print("-----------------------------")
}

```

## Old genes MANE

```{r}
for (gene in old_genes_MANE){
  print(gene)
  df <- dat[which(dat$Gene == gene),]
  # grep COSMIC legacy mutation IDs that are coding by selecting those that start with COSM
  # COSN is non coding
  df <- df[str_detect(df$LEGACY_MUTATION_ID, "COSM"), ]
  print(paste("The Ensemble transcripts for", gene, " is:", paste(unique(df$ACCESSION_NUMBER), collapse =  " & "), collapse = ""))

  txs = paste(unique(df$ACCESSION_NUMBER))
  total_COSMs <- unique(df[which(df$GENOMIC_MUTATION_ID != "null"  &  df$MUTATION_DESCRIPTION != "Unknown"), "LEGACY_MUTATION_ID"])
  print(paste("Total COSMs for this gene is: ", length(total_COSMs), sep = " "))
  for (i in 1:length(txs)){
    transcripts = txs[i]
    
    print(paste(transcripts, length(unique(df[which(df$ACCESSION_NUMBER %in% transcripts & df$GENOMIC_MUTATION_ID != "null" &  df$MUTATION_DESCRIPTION != "Unknown"), "LEGACY_MUTATION_ID"]))), sep = "_")
    
    row <- c(gene, transcripts, length(unique(df[which(df$ACCESSION_NUMBER %in% transcripts & df$GENOMIC_MUTATION_ID != "null" &  df$MUTATION_DESCRIPTION != "Unknown"), "LEGACY_MUTATION_ID"])))
    summary_tbl <- rbind(summary_tbl, row)
  }
  print("-----------------------------")
}

write.table(summary_tbl, "transcripts_220401.tsv", sep = "\t",row.names=FALSE)

```
